class t{constructor(t,r,e,s,n){this._name=t,this._consumer=r,this._property=e,this._method=s,this._callback=n}get name(){return this._name}get consumer(){return this._consumer}get property(){return this._property}get method(){return this._method}get callback(){return this._callback}}const r=Symbol("@runopencode:state:consume:requests");function e(t){return function(e,s,i){t=Object.assign({callback:null},t);let o=Reflect.getMetadata(r,e)||[],c=new n(t.name,s,t.callback,i?"method":"property");o.push(c),Reflect.defineMetadata(r,o,e)}}function s(e){let s=[];return Reflect.getMetadata(r,e).forEach(r=>{let n=r.callback;"string"==typeof r.callback&&(n=e[r.callback]);let i=new t(r.name,e,"property"===r.type?r.property:null,"method"===r.type?e[r.property]:null,n);s.push(i)}),s}class n{constructor(t,r,e,s){this._name=t,this._property=r,this._callback=e,this._type=s}get name(){return this._name}get property(){return this._property}get callback(){return this._callback}get type(){return this._type}}function i(t){return"function"==typeof t}let o=!1;const c={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}o=t},get useDeprecatedSynchronousErrorHandling(){return o}};function h(t){setTimeout(()=>{throw t},0)}const u={closed:!0,next(t){},error(t){if(c.useDeprecatedSynchronousErrorHandling)throw t;h(t)},complete(){}},a=Array.isArray||(t=>t&&"number"==typeof t.length);function l(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,r)=>`${r+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}l.prototype=Object.create(Error.prototype);const b=l;class p{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:r,_unsubscribe:e,_subscriptions:s}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof p)r.remove(this);else if(null!==r)for(let t=0;t<r.length;++t)r[t].remove(this);if(i(e))try{e.call(this)}catch(r){t=r instanceof b?d(r.errors):[r]}if(a(s)){let r=-1,e=s.length;for(;++r<e;){const e=s[r];if(null!==(n=e)&&"object"==typeof n)try{e.unsubscribe()}catch(r){t=t||[],r instanceof b?t=t.concat(d(r.errors)):t.push(r)}}}var n;if(t)throw new b(t)}add(t){let r=t;if(!t)return p.EMPTY;switch(typeof t){case"function":r=new p(t);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof p)){const t=r;(r=new p)._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:e}=r;if(null===e)r._parentOrParents=this;else if(e instanceof p){if(e===this)return r;r._parentOrParents=[e,this]}else{if(-1!==e.indexOf(this))return r;e.push(this)}const s=this._subscriptions;return null===s?this._subscriptions=[r]:s.push(r),r}remove(t){const r=this._subscriptions;if(r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}}function d(t){return t.reduce((t,r)=>t.concat(r instanceof b?r.errors:r),[])}p.EMPTY=function(t){return t.closed=!0,t}(new p);const f="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class _ extends p{constructor(t,r,e){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=u;break;case 1:if(!t){this.destination=u;break}if("object"==typeof t){t instanceof _?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new y(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new y(this,t,r,e)}}[f](){return this}static create(t,r,e){const s=new _(t,r,e);return s.syncErrorThrowable=!1,s}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class y extends _{constructor(t,r,e,s){let n;super(),this._parentSubscriber=t;let o=this;i(r)?n=r:r&&(n=r.next,e=r.error,s=r.complete,r!==u&&(i((o=Object.create(r)).unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=n,this._error=e,this._complete=s}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:r}=this;c.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:r}=this,{useDeprecatedSynchronousErrorHandling:e}=c;if(this._error)e&&r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(r.syncErrorThrowable)e?(r.syncErrorValue=t,r.syncErrorThrown=!0):h(t),this.unsubscribe();else{if(this.unsubscribe(),e)throw t;h(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const r=()=>this._complete.call(this._context);c.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,r){try{t.call(this._context,r)}catch(t){if(this.unsubscribe(),c.useDeprecatedSynchronousErrorHandling)throw t;h(t)}}__tryOrSetError(t,r,e){if(!c.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{r.call(this._context,e)}catch(r){return c.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(h(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const w="function"==typeof Symbol&&Symbol.observable||"@@observable";class E{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const r=new E;return r.source=this,r.operator=t,r}subscribe(t,r,e){const{operator:s}=this,n=function(t,r,e){if(t){if(t instanceof _)return t;if(t[f])return t[f]()}return t||r||e?new _(t,r,e):new _(u)}(t,r,e);if(n.add(s?s.call(n,this.source):this.source||c.useDeprecatedSynchronousErrorHandling&&!n.syncErrorThrowable?this._subscribe(n):this._trySubscribe(n)),c.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable&&(n.syncErrorThrowable=!1,n.syncErrorThrown))throw n.syncErrorValue;return n}_trySubscribe(t){try{return this._subscribe(t)}catch(r){c.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),function(t){for(;t;){const{closed:r,destination:e,isStopped:s}=t;if(r||s)return!1;t=e&&e instanceof _?e:null}return!0}(t)?t.error(r):console.warn(r)}}forEach(t,r){return new(r=g(r))((r,e)=>{let s;s=this.subscribe(r=>{try{t(r)}catch(t){e(t),s&&s.unsubscribe()}},e,r)})}_subscribe(t){const{source:r}=this;return r&&r.subscribe(t)}[w](){return this}pipe(...t){return 0===t.length?this:((r=t)?1===r.length?r[0]:function(t){return r.reduce((t,r)=>r(t),t)}:function(){})(this);var r}toPromise(t){return new(t=g(t))((t,r)=>{let e;this.subscribe(t=>e=t,t=>r(t),()=>t(e))})}}function g(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}function m(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}E.create=t=>new E(t),m.prototype=Object.create(Error.prototype);const S=m;class x extends p{constructor(t,r){super(),this.subject=t,this.subscriber=r,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,r=t.observers;if(this.subject=null,!r||0===r.length||t.isStopped||t.closed)return;const e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}class O extends _{constructor(t){super(t),this.destination=t}}class v extends E{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[f](){return new O(this)}lift(t){const r=new T(this,this);return r.operator=t,r}next(t){if(this.closed)throw new S;if(!this.isStopped){const{observers:r}=this,e=r.length,s=r.slice();for(let r=0;r<e;r++)s[r].next(t)}}error(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:r}=this,e=r.length,s=r.slice();for(let r=0;r<e;r++)s[r].error(t);this.observers.length=0}complete(){if(this.closed)throw new S;this.isStopped=!0;const{observers:t}=this,r=t.length,e=t.slice();for(let t=0;t<r;t++)e[t].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new S;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),p.EMPTY):this.isStopped?(t.complete(),p.EMPTY):(this.observers.push(t),new x(this,t))}asObservable(){const t=new E;return t.source=this,t}}v.create=(t,r)=>new T(t,r);class T extends v{constructor(t,r){super(),this.destination=t,this.source=r}next(t){const{destination:r}=this;r&&r.next&&r.next(t)}error(t){const{destination:r}=this;r&&r.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:r}=this;return r?this.source.subscribe(t):p.EMPTY}}class j extends v{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const r=super._subscribe(t);return r&&!r.closed&&t.next(this._value),r}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value}next(t){super.next(this._value=t)}}class P{constructor(t,r){this.project=t,this.thisArg=r}call(t,r){return r.subscribe(new k(t,this.project,this.thisArg))}}class k extends _{constructor(t,r,e){super(t),this.project=r,this.count=0,this.thisArg=e||this}_next(t){let r;try{r=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(r)}}class D{constructor(t=null){this._snapshot=t,this._subject=new j(t)}set(t){this._snapshot=t,this._subject.next(t)}patch(t){this._snapshot=Object.assign({},this._snapshot||{},t),this._subject.next(this._snapshot)}select(t){return this._subject.pipe((r=t,function(t){if("function"!=typeof r)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new P(r,void 0))}));var r}snapshot(){return this._snapshot}subscribe(t){return this._subject.subscribe(t)}}const M=Symbol("@runopencode:state:provide:registry");function H(t){return function(r,e){t=Object.assign({defaults:null},t);let s=`__${e}__`;delete r.constructor.prototype[e],Object.defineProperty(r.constructor.prototype,e,{configurable:!0,enumerable:!0,get:function(){return this[s]||Object.defineProperty(this,s,{value:new D(t.defaults),enumerable:!1,writable:!1}),this[s]}});let n=Reflect.getMetadata(M,r)||new Map;n.set(t.name,e),Reflect.defineMetadata(M,n,r)}}function A(t){let r=Reflect.getMetadata(M,t),e=new Map;return r.forEach(function(r,s){e.set(s,t[r])}),e}export{e as C,H as P,v as S,A as a,s as g};