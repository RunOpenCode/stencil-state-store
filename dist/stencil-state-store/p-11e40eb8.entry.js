import{r as t,h as e,H as s,c as n,g as r}from"./p-fb18e78a.js";import{C as o,P as i,S as c,g as l,a as u}from"./p-7a9a9943.js";const h=class{constructor(e){t(this,e),this.prop=null,this.increase=async()=>{let t=await this.store,e=t.snapshot();e.counter++,t.patch(e)}}async componentDidLoad(){let t=await this.store;this.subscription=t.subscribe(()=>{this.counter=t.snapshot().counter})}disconnectedCallback(){this.subscription.unsubscribe()}render(){return e(s,null,e("state-store-consumer",{consumer:this}),e("div",null,e("div",null,"Current value rendered from consumer component: ",e("span",null,this.counter)),e("div",null,e("button",{onClick:this.increase},"Increase counter from consumer"))))}};!function(t,e,s,n){var r,o=arguments.length,i=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,s,n);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(i=(o<3?r(i):o>3?r(e,s,i):r(e,s))||i);o>3&&i&&Object.defineProperty(e,s,i)}([o("demo-store"),function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",Promise)],h.prototype,"store",void 0);const a=class{constructor(e){t(this,e),this.increase=()=>{let t=this.store.snapshot();t.counter++,this.store.patch(t)}}connectedCallback(){this.subscription=this.store.subscribe(t=>{this.counter=t.counter})}disconnectedCallback(){this.subscription.unsubscribe()}render(){return e(s,null,e("state-store-provider",{provider:this}),e("slot",null),e("div",null,e("div",null,"Current value rendered from provider component: ",e("span",null,this.counter)),e("div",null,e("button",{onClick:this.increase},"Increase counter from provider"))))}};!function(t,e,s,n){var r,o=arguments.length,i=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,s,n);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(i=(o<3?r(i):o>3?r(e,s,i):r(e,s))||i);o>3&&i&&Object.defineProperty(e,s,i)}([i({name:"demo-store",defaults:{counter:1}}),function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",Object)],a.prototype,"store",void 0);class d{constructor(){this._subject=new c}subscribe(t){return this._subject.subscribe(t)}notify(){this._subject.next()}static getInstance(){return d._instance||(d._instance=new d),d._instance}}const f=class{constructor(e){t(this,e),this.requests=[],this.subscription=null,this.request=n(this,"runopencode:store:consumer:request",7)}connectedCallback(){this.requests=l(this.consumer),this.require(),0!==this.requests.length&&(this.subscription=d.getInstance().subscribe(()=>{this.require()}))}disconnectedCallback(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.requests=[]}require(){let t=[];this.requests.forEach(e=>{this.request.emit(e).defaultPrevented&&t.push(e)}),t.forEach(t=>{this.requests.splice(this.requests.indexOf(t),1)}),0===this.requests.length&&null!==this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}render(){return e(s,null,e("slot",null))}},p=class{constructor(e){t(this,e),this.onStoreRequested=t=>{let e=t.detail;if(!this.stores.has(e.name))return;t.stopPropagation(),t.preventDefault();let s=this.stores.get(e.name);e.consumer[e.property].resolve(s)}}connectedCallback(){let t=Array.from(this.el.childNodes).filter(t=>"#comment"!==t.nodeName),e=this.el;0!==t.length||(e=this.el.parentElement),e.addEventListener("runopencode:store:consumer:request",this.onStoreRequested),this.stores=u(this.provider),d.getInstance().notify()}disconnectedCallback(){this.el.removeEventListener("runopencode:store:consumer:request",this.onStoreRequested),this.el.parentElement.removeEventListener("runopencode:store:consumer:request",this.onStoreRequested)}render(){return e(s,null,e("slot",null))}get el(){return r(this)}};export{h as demo_consumer,a as demo_provider,f as state_store_consumer,p as state_store_provider}