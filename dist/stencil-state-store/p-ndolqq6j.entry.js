import{r as e,h as t,c as s}from"./p-f969966e.js";import{C as r,P as n,S as o,g as i,a as c}from"./p-03875da1.js";var u=function(e,t,s,r){var n,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(i=(o<3?n(i):o>3?n(t,s,i):n(t,s))||i);return o>3&&i&&Object.defineProperty(t,s,i),i},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class l{constructor(t){e(this,t),this.prop=null}injectStore(e){}onDefaultStoreProvided(e){this.store=e,this.subscription=this.store.subscribe(e=>{this.counter=e.counter})}disconnectedCallback(){this.subscription.unsubscribe()}increase(){let e=this.store.snapshot();e.counter++,this.store.patch(e)}render(){return t("state-store-consumer",{consumer:this},t("div",null,"Current value rendered from consumer component: ",t("span",null,this.counter)),t("div",null,t("button",{onClick:this.increase.bind(this)},"Increase counter from consumer")),t("slot",null))}}u([r({name:"demo-store",callback:"onDefaultStoreProvided"}),a("design:type",Object)],l.prototype,"store",void 0),u([r({name:"demo-store",callback:()=>{}}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],l.prototype,"injectStore",null);class d{constructor(t){e(this,t)}connectedCallback(){this.subscription=this.store.subscribe(e=>{this.counter=e.counter})}disconnectedCallback(){this.subscription.unsubscribe()}increase(){let e=this.store.snapshot();e.counter++,this.store.patch(e)}render(){return t("state-store-provider",{provider:this},t("div",null,"Current value rendered from provider component: ",t("span",null,this.counter)),t("div",null,t("button",{onClick:this.increase.bind(this)},"Increase counter from provider")),t("slot",null))}}!function(e,t,s,r){var n,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(i=(o<3?n(i):o>3?n(t,s,i):n(t,s))||i);o>3&&i&&Object.defineProperty(t,s,i)}([n({name:"demo-store",defaults:{counter:1}}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],d.prototype,"store",void 0);class p{constructor(){this._subject=new o,document.addEventListener("@runopencode:store:provider:register",this.onProviderRegistered.bind(this))}subscribe(e){return this._subject.subscribe(e)}onProviderRegistered(){this._subject.next()}static getInstance(){return p._instance||(p._instance=new p),p._instance}}class h{constructor(t){e(this,t),this.requests=[],this.subscription=null,this.request=s(this,"runopencode:store:consumer:request",7)}connectedCallback(){this.requests=i(this.consumer),this.require(),0!==this.requests.length&&(this.subscription=p.getInstance().subscribe(()=>{this.require()}))}disconnectedCallback(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.requests=[]}render(){return t("slot",null)}require(){let e=[];this.requests.forEach(t=>{this.request.emit(t).defaultPrevented&&e.push(t)}),e.forEach(e=>{this.requests.splice(this.requests.indexOf(e),1)}),0===this.requests.length&&(this.subscription.unsubscribe(),this.subscription=null)}}class b{constructor(t){e(this,t),this.register=s(this,"@runopencode:store:provider:register",7)}connectedCallback(){this.stores=c(this.provider),this.register.emit()}onRequest(e){let t=e.detail;if(!this.stores.has(t.name))return;e.stopPropagation(),e.preventDefault();let s=this.stores.get(t.name);t.property&&(t.consumer[t.property]=s),t.method&&t.method.apply(t.consumer,[s]),t.callback&&t.callback.apply(t.consumer,[s])}render(){return t("slot",null)}}export{l as demo_consumer,d as demo_provider,h as state_store_consumer,b as state_store_provider};